# Base image
FROM python:3.11-slim

# Create app dir
WORKDIR /app

# Copy code
COPY garmin_metrics.py .
COPY streamlit_app.py .
COPY alerts.py .
COPY requirements.txt .

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Create non-root user for safety
RUN useradd --create-home appuser
USER appuser
WORKDIR /home/appuser

# Make a place for DB and outputs (expected to be mounted)
RUN mkdir -p /home/appuser/data /home/appuser/outputs

# Expose Streamlit default port
EXPOSE 8501

# By default run streamlit (override in compose to run batch)
ENTRYPOINT ["streamlit", "run", "/app/streamlit_app.py", "--server.headless", "true", "--server.port", "8501", "--server.address", "0.0.0.0"]
